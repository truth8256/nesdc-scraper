# NESDC Scraper 워크플로우 최종 평가

## 📋 전체 파이프라인

```
1. Page Index 생성 (summarize_pdf_pages.py)
   └─> page_index.csv (411 pages from 18/20 folders)

2. 키워드 검색 (find_target_pages.py)
   └─> 정당지지도 페이지 자동 탐지: 13/20 folders (65%)

3. 파싱 실행 (pdfplumber_table_parser.py)
   └─> 표준 스키마 JSON 생성: 7/13 folders (53.8%)

4. 유효성 검증 (schema.py)
   └─> 7/7 성공 파일 모두 100% 점수
```

---

## 🎯 성능 지표

### 1단계: 페이지 인덱스 생성
- **입력**: 20개 폴더 (15300-15322, 제외: 15301, 15313, 15318)
- **성공**: 18/20 폴더 (90%)
- **실패**: 2/20 (15306, 15307 - PDF 인코딩 오류)
- **결과**: 411개 페이지 인덱싱 완료

### 2단계: 정당지지도 페이지 자동 탐지
- **입력**: 20개 폴더
- **성공**: 13/20 폴더 (65%)
- **실패 원인**:
  - 15306, 15307: PDF 인코딩 오류
  - 15314, 15315, 15316, 15317: 정당지지도 항목 없음 (교육감, 시장 선거)
  - 15320: 검색 누락 (추가 조사 필요)

**성공한 13개 폴더**:
```
15300, 15302, 15303, 15304, 15305,
15308, 15309, 15310, 15311, 15312,
15319, 15321, 15322
```

### 3단계: pdfplumber vs Docling 파서 비교

#### pdfplumber 파서
- **성공률**: 7/13 (53.8%)
- **평균 유효성 점수**: 100%
- **성공 폴더**: 15308, 15309, 15310, 15311, 15312, 15321, 15322
- **실패 원인**:
  - 15300-15305, 15319: 표 구조 인식 실패 또는 데이터 추출 오류

#### Docling 파서
- **성공률**: 0/13 (0%)
- **평균 유효성 점수**: N/A
- **실패 원인**: 모든 파일에서 표 인식 실패 (빈 JSON 생성)

---

## 📊 전체 성공률

### End-to-End 성공률
```
입력 20개 폴더
  → 페이지 탐지 성공 13개 (65%)
    → pdfplumber 파싱 성공 7개 (53.8%)
      = 최종 성공: 7/20 = 35%
```

### 파서별 비교

| 지표 | pdfplumber | Docling | 승자 |
|------|-----------|---------|------|
| 성공률 | 53.8% (7/13) | 0% (0/13) | **pdfplumber** |
| 평균 점수 | 100% | N/A | **pdfplumber** |
| 데이터 품질 | 완벽 | 없음 | **pdfplumber** |
| 속도 | 빠름 | 느림 | **pdfplumber** |

---

## 🏆 주요 성과

### 1. 자동화된 페이지 탐지 (65% 성공률)
이전 `page_finder_v2.py`의 20% 대비 **3배 이상 향상**

**개선 방법**:
- PDF 전체 페이지 요약 인덱스 생성
- 키워드 + 표 데이터 우선순위 검색
- 6페이지 이후만 검색 (요약/목차 제외)

### 2. 높은 파싱 품질 (100% 유효성)
성공한 7개 파일 모두 완벽한 스키마 준수

**성공 사례**:
- CBS-KSOI 포맷 (15308, 15309, 15310, 15311): 4/4 성공
- 비전코리아 포맷 (15312, 15321, 15322): 3/3 성공

### 3. 표준화된 워크플로우
```bash
# 1. 페이지 인덱스 생성
python summarize_pdf_pages.py --id-range 15300 15322

# 2. 페이지 자동 탐지
python find_target_pages.py

# 3. 파싱 실행 (권장 페이지로)
python pdfplumber_table_parser.py --folder 15310 --pages 11 12

# 4. 결과 검증
python manual_comparison.py
```

---

## ⚠️ 제한사항

### 1. 파서 성공률 (53.8%)
**실패 원인 분석**:
- **표 구조 복잡도**: 일부 PDF는 복잡한 표 레이아웃
- **페이지 범위**: 일부 표가 여러 페이지에 걸쳐 있음
- **PDF 품질**: 텍스트 레이어 품질 차이

**실패한 폴더들**:
- 15300: 한길리서치 - 표 구조 복잡
- 15302: 에브리리서치(포항) - 페이지 10만 추출 시도
- 15303: 에브리리서치(영덕) - 페이지 8만 추출 시도
- 15304: KIR - 페이지 6만 추출 시도
- 15305: 이너텍(김제) - 페이지 11, 13 추출 시도
- 15319: 이너텍(포항) - 페이지 8, 12 추출 시도

### 2. Docling 완전 실패
- 설치 및 설정 문제 가능성
- 한국어 표 인식 한계
- 복잡한 표 레이아웃 처리 실패

---

## 💡 권장사항

### ✅ 채택
1. **pdfplumber 파서 사용**
   - 53.8% 성공률, 100% 데이터 품질
   - CBS-KSOI, 비전코리아 포맷에서 완벽 작동

2. **page_index 기반 검색 방식**
   - 65% 자동 탐지 성공률
   - 검색 가능한 인덱스 제공

3. **표준 스키마 (schema.py)**
   - 일관된 데이터 구조
   - 자동 유효성 검증

### ❌ 제외
1. **Docling 파서**
   - 0% 성공률
   - 추가 개선 없이는 사용 불가

2. **page_finder_v2 (자동 탐지)**
   - 20% 성공률 (page_index 대비 낮음)

### 🔄 개선 필요
1. **파싱 성공률 향상**
   - 실패한 6개 폴더 케이스 분석
   - pdfplumber 파라미터 튜닝
   - 대체 파서 검토 (camelot, tabula 등)

2. **멀티페이지 표 지원**
   - 현재: 단일 페이지만 처리
   - 개선: 연속 페이지 병합 로직 추가

3. **수동 매핑 파일 추가**
   - 자동 탐지 실패 시 폴백
   - JSON 파일로 페이지 매핑 관리

---

## 📈 개선 로드맵

### Phase 1: 현재 상태 (완료)
- ✅ 페이지 인덱스 생성
- ✅ 키워드 기반 자동 탐지
- ✅ pdfplumber 파서
- ✅ 표준 스키마 및 검증

### Phase 2: 품질 개선 (권장)
- 🔲 실패 케이스 분석 및 개선
- 🔲 멀티페이지 표 지원
- 🔲 대체 파서 테스트
- 🔲 수동 매핑 파일 기능

### Phase 3: 확장 (선택)
- 🔲 다른 키워드 지원 (국정운영, 대선후보)
- 🔲 배치 처리 자동화
- 🔲 웹 인터페이스

---

## 🎓 결론

**현재 워크플로우는 실용 가능한 수준**

- **전체 성공률 35%** (7/20 folders)
- **성공 시 데이터 품질 100%**
- **CBS-KSOI, 비전코리아 포맷에 강함**

**다음 단계**:
1. 실패한 6개 케이스 개별 분석
2. 파싱 로직 개선
3. 수동 매핑 파일로 100% 커버리지 달성

---

생성일: 2026-02-21
테스트 데이터: 15300-15322 (20 folders)
